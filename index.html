<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>A Love Letter for My Village Girl ðŸ’Œ</title>
<style>
  :root{
    --pink-1: #fff0f6;
    --pink-2: #ffd6e7;
    --accent: #ff6fa3;
    --soft: rgba(255,111,163,0.12);
    --text: #3a1f2b;
  }
  html,body{
    height:100%;
    margin:0;
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    background: linear-gradient(160deg, #fff6fb 0%, #ffeef6 35%, #fff 100%);
    color:var(--text);
  }

  /* Centering container */
  .wrap{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
    box-sizing:border-box;
    gap:20px;
    flex-direction:column;
  }

  h1{
    margin:0 0 6px 0;
    font-size:18px;
    font-weight:600;
    color:#7a2742;
    text-align:center;
  }
  p.subtitle{
    margin:0 0 18px 0;
    font-size:13px;
    color:#8a5167;
    text-align:center;
  }

  /* Envelope */
  .envelope-wrap{
    width:86%;
    max-width:420px;
    aspect-ratio: 4/3;
    max-height:520px;
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
    touch-action: manipulation;
  }

  .envelope {
    width:260px;
    max-width:80%;
    height:160px;
    position:relative;
    perspective:900px;
    cursor:pointer;
    filter: drop-shadow(0 10px 18px rgba(160,80,120,0.12));
    -webkit-tap-highlight-color: transparent;
  }

  /* Back of envelope / body */
  .env-body{
    position:absolute;
    inset:0;
    background:linear-gradient(180deg,#fff 0%, #fff6f8 100%);
    border-radius:12px;
    border:1px solid rgba(255,110,150,0.14);
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }

  /* flap */
  .env-flap{
    position:absolute;
    left:50%;
    top:-2%;
    width:120%;
    transform-origin:50% 0%;
    transform: translateX(-50%) rotateX(0deg);
    height:110%;
    background: linear-gradient(180deg,#ffdce9 0%, #ffb6d1 60%);
    border-radius:12px 12px 8px 8px;
    border:1px solid rgba(255,110,150,0.14);
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: inset 0 -6px 12px rgba(255,255,255,0.25);
    transition: transform 1s cubic-bezier(.2,.9,.2,1);
  }

  .env-front {
    position:absolute;
    left:50%;
    bottom:-6%;
    transform:translateX(-50%);
    width:120%;
    height:70%;
    background: linear-gradient(180deg,#fff 0%, #fff0f3 100%);
    border-radius:8px;
    transform-origin:50% 100%;
    border:1px solid rgba(255,110,150,0.06);
    box-shadow: 0 10px 18px rgba(160,80,120,0.06);
  }

  .envelope.opened .env-flap{
    transform: translateX(-50%) rotateX(-180deg);
    transition: transform 1s cubic-bezier(.2,.9,.2,1);
  }
  .envelope.opened .env-front{
    transform: translateX(-50%) translateY(18%);
    transition: transform 0.9s cubic-bezier(.2,.9,.2,1);
  }

  /* Envelope label */
  .env-label{
    position:relative;
    z-index:12;
    text-align:center;
    pointer-events:none;
  }
  .env-label .title{
    font-size:16px;
    font-weight:700;
    color:#6b2a44;
  }
  .env-label .small{
    font-size:12px;
    color:#8b536c;
    margin-top:4px;
  }

  /* Heart container (hidden until open) */
  .heart-area{
    position:absolute;
    width:260px;
    max-width:80%;
    height:260px;
    bottom:-60%;
    left:50%;
    transform:translateX(-50%) scale(0.92);
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
    opacity:0;
    transition: opacity 0.6s ease 0.6s, transform 0.6s ease 0.6s;
  }

  .envelope.opened ~ .heart-area{
    opacity:1;
    transform:translateX(-50%) translateY(-12%) scale(1);
  }

  .heart-stage{
    width:220px;
    height:220px;
    position:relative;
    display:block;
    transform-origin:center;
  }

  /* little hearts */
  .little-heart{
    position:absolute;
    width:14px;
    height:14px;
    transform-origin:center;
    opacity:0;
    transform: translate(-50%,-50%) scale(0.6) rotate(0deg);
    transition: transform 0.9s cubic-bezier(.2,.9,.2,1), opacity 0.6s ease;
  }
  .little-heart::before,
  .little-heart::after{
    content:"";
    position:absolute;
    width:14px;
    height:14px;
    border-radius:50%;
    background:linear-gradient(180deg,#ff9fc6 0%, #ff5a9a 100%);
    left:0;
    top:0;
  }
  .little-heart::before{
    transform: translateX(-6px);
  }
  .little-heart::after{
    transform: translateY(-6px);
  }
  /* rotate so it looks like a heart */
  .little-heart > .core{
    position:absolute;
    left:0; top:0; right:0; bottom:0;
    transform: rotate(-45deg);
    width:14px; height:14px;
    border-radius:3px;
    background:linear-gradient(180deg,#ff6fa3 0%, #ff4a85 100%);
    box-shadow: 0 6px 12px rgba(255,110,150,0.12);
  }

  /* pulse (big heart beat) */
  .heart-stage.pulse{
    animation: heartBeat 1.2s ease-in-out infinite;
  }
  @keyframes heartBeat{
    0%{ transform: scale(1) }
    25%{ transform: scale(1.06) }
    50%{ transform: scale(1) }
    75%{ transform: scale(1.06) }
    100%{ transform: scale(1) }
  }

  /* message text */
  .message {
    max-width:480px;
    width:90%;
    margin-top:20px;
    background: rgba(255,255,255,0.7);
    padding:18px;
    border-radius:12px;
    border:1px solid rgba(255,110,150,0.08);
    box-shadow: 0 6px 18px rgba(160,80,120,0.04);
    text-align:center;
    opacity:0;
    transform: translateY(8px);
    transition: opacity 0.8s ease 0.6s, transform 0.8s ease 0.6s;
    backdrop-filter: blur(4px);
  }
  .message.show{
    opacity:1;
    transform: translateY(0);
  }
  .message h2{
    margin:0 0 8px 0;
    font-size:20px;
    color:#7a2742;
  }
  .message p{
    margin:0;
    color:#6b3b4b;
    line-height:1.45;
    font-size:15px;
  }

  /* replay button */
  .controls{
    margin-top:12px;
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:center;
  }
  .btn{
    background:linear-gradient(180deg,#ff9fc6 0%, #ff6a9b 100%);
    color:white;
    border:none;
    padding:10px 18px;
    border-radius:999px;
    font-weight:600;
    box-shadow: 0 8px 20px rgba(255,110,150,0.16);
    cursor:pointer;
    transform:translateY(0);
  }
  .btn:active{ transform:translateY(1px) }
  .muted{
    background:transparent;
    color:#8b536c;
    border:1px solid rgba(140,80,120,0.08);
    padding:9px 14px;
    border-radius:999px;
    cursor:pointer;
  }

  /* small helper text for mobile */
  .hint{
    margin-top:8px;
    font-size:12px;
    color:#9b5a76;
    text-align:center;
  }

  /* Responsiveness */
  @media (max-width:480px){
    .envelope { width:220px; height:140px; }
    .heart-area{ width:85%; height:220px; bottom:-52%; }
    .heart-stage{ width:185px; height:185px; }
    .little-heart{ width:12px; height:12px; }
    .little-heart::before, .little-heart::after { width:12px; height:12px; }
    .little-heart > .core { width:12px; height:12px; }
    h1{ font-size:16px; }
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>A Love Letter for My Village Girl ðŸ’Œ</h1>
  <p class="subtitle">Tap the envelope to open it â€” Victoria, this one's for you.</p>

  <div class="envelope-wrap">
    <div id="envelope" class="envelope" role="button" aria-label="Open love letter">
      <div class="env-body">
        <div class="env-label">
          <div class="title">A Love Letter</div>
          <div class="small">Tap to open your love letter ðŸ’–</div>
        </div>
      </div>

      <div class="env-flap" aria-hidden="true"></div>
      <div class="env-front" aria-hidden="true"></div>
    </div>

    <div id="heartArea" class="heart-area" aria-hidden="true">
      <div id="heartStage" class="heart-stage" aria-hidden="true"></div>
    </div>
  </div>

  <div id="message" class="message" aria-live="polite">
    <h2>My Village Girl ðŸ’–</h2>
    <p id="messageText">
      Youâ€™re the rhythm in my heart, the smile in my every thought. I love you endlessly, Victoria.
    </p>
  </div>

  <div class="controls">
    <button id="replayBtn" class="btn" style="display:none">Replay ðŸ’ž</button>
    <button id="muteBtn" class="muted" aria-pressed="false">Pause</button>
  </div>

  <div class="hint">Works best with volume on. Place <strong>champagne.mp3</strong> in the same folder as this file.</div>
</div>

<!-- Audio (file must be placed in same folder) -->
<audio id="song" preload="auto" src="champagne.mp3"></audio>

<script>
/* Soft romantic envelope -> open -> play audio -> generate hearts forming a heart shape -> pulse -> show message -> show replay */
(function(){
  const envelope = document.getElementById('envelope');
  const heartStage = document.getElementById('heartStage');
  const heartArea = document.getElementById('heartArea');
  const message = document.getElementById('message');
  const replayBtn = document.getElementById('replayBtn');
  const muteBtn = document.getElementById('muteBtn');
  const audio = document.getElementById('song');

  let opened = false;
  let hearts = [];
  const HEART_COUNT = 60; // number of tiny hearts
  const SCALE = 9; // scale for heart equation
  const centerX = 110; // center within stage (half of stage width approx)
  const centerY = 100;

  // Heart parametric function (classic heart curve)
  function heartXY(t){
    // t in [0, 2PI]
    const x = 16 * Math.pow(Math.sin(t), 3);
    const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
    return {x: x, y: -y}; // invert y so it faces upward
  }

  // create hearts and animate them into position along curve
  function createHearts(){
    // ensure stage size
    const rect = heartStage.getBoundingClientRect();
    const w = rect.width;
    const h = rect.height;
    hearts = [];
    heartStage.innerHTML = '';
    for(let i=0;i<HEART_COUNT;i++){
      const el = document.createElement('div');
      el.className = 'little-heart';
      const core = document.createElement('div');
      core.className = 'core';
      el.appendChild(core);
      heartStage.appendChild(el);
      hearts.push(el);

      // compute t along curve with slight randomness to distribute
      const t = (i / HEART_COUNT) * Math.PI * 2;
      const point = heartXY(t);

      // normalize and scale to stage size
      const px = centerX + point.x * SCALE + (Math.random()*8 - 4);
      const py = centerY + point.y * SCALE * 0.95 + (Math.random()*8 - 4);

      // Start hearts from the top (inside envelope) or from center with tiny scale
      el.style.left = (w/2) + 'px';
      el.style.top = (h + 10) + 'px';
      el.style.opacity = '0';
      el.style.transform = 'translate(-50%,-50%) scale(0.6) rotate(0deg)';

      // schedule their move (stagger)
      (function(el, px, py, idx){
        const delay = 300 + idx * 25 + Math.random()*220;
        setTimeout(()=> {
          el.style.transition = 'transform 900ms cubic-bezier(.2,.9,.2,1), opacity 560ms ease';
          el.style.left = px + 'px';
          el.style.top = py + 'px';
          el.style.opacity = '1';
          el.style.transform = 'translate(-50%,-50%) scale(1) rotate(' + (Math.random()*20 - 10) + 'deg)';
        }, delay);
      })(el, px, py, i);
    }

    // after hearts have settled, start pulsing stage
    setTimeout(()=> {
      heartStage.classList.add('pulse');
    }, 1600);
  }

  // remove hearts and pulse
  function clearHearts(){
    heartStage.classList.remove('pulse');
    heartStage.innerHTML = '';
    hearts = [];
  }

  // open sequence
  function openEnvelope(){
    if(opened) return;
    opened = true;
    envelope.classList.add('opened');

    // allow a small delay for fold animation then show hearts + play song + show message
    setTimeout(()=> {
      // play audio; browsers require user gesture, envelope click is good
      audio.currentTime = 0;
      // try-catch for autoplay restrictions
      audio.play().catch(()=>{ /* if can't autoplay, user can press play via UI */ });

      // generate hearts
      createHearts();

      // reveal message after gentle delay
      setTimeout(()=> {
        message.classList.add('show');
        replayBtn.style.display = 'inline-block';
      }, 1200);
    }, 700);
  }

  // reset to initial
  function resetAll(){
    opened = false;
    envelope.classList.remove('opened');
    message.classList.remove('show');
    replayBtn.style.display = 'none';
    clearHearts();
    try {
      audio.pause();
      audio.currentTime = 0;
    } catch(e){}
    // small delay before allowing to open again so animations reset visually
    setTimeout(()=>{
      // nothing else needed; ready to open again
    }, 300);
  }

  // click / tap to open
  envelope.addEventListener('click', function(e){
    if(!opened){
      openEnvelope();
    }
  }, {passive:true});

  // replay button
  replayBtn.addEventListener('click', function(){
    // soft reset then reopen
    resetAll();
    setTimeout(()=> {
      openEnvelope();
    }, 450);
  });

  // mute/pause toggle
  muteBtn.addEventListener('click', function(){
    if(audio.paused){
      audio.play().catch(()=>{});
      muteBtn.textContent = 'Pause';
      muteBtn.setAttribute('aria-pressed','false');
    } else {
      audio.pause();
      muteBtn.textContent = 'Play';
      muteBtn.setAttribute('aria-pressed','true');
    }
  });

  // Accessibility: space/enter to open
  envelope.addEventListener('keydown', function(e){
    if(e.key === 'Enter' || e.key === ' '){
      e.preventDefault();
      if(!opened) openEnvelope();
    }
  });

  // Touch support: ensure tap works on mobile (already covered by click).
  // If user wants to auto-open on focus or something, we are not doing that to preserve gesture requirement.

  // Small UX: if user leaves page, pause audio
  document.addEventListener('visibilitychange', function(){
    if(document.hidden){
      audio.pause();
      muteBtn.textContent = 'Play';
      muteBtn.setAttribute('aria-pressed','true');
    }
  });

  // initial: ensure message hidden, replay hidden
  resetAll();
})();
</script>
</body>
</html>

